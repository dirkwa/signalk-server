# SignalK Server Security Vulnerability Checklist

Based on codebase analysis, these are the key areas to test for security vulnerabilities.

## Previously Addressed (Separate Branches)

- [ ] issue_2178 - [Description]
- [ ] issue_2180 - [Description]
- [ ] issue_2181 - [Description]

---

## 1. Authentication Vulnerabilities

### 1.1 Token Security
- [ ] JWT "none" algorithm attack (CVE-2015-9235 style)
- [ ] JWT algorithm confusion (RS256 vs HS256)
- [ ] Token in query parameter (URL logging exposure)
- [ ] Token expiration bypass
- [ ] Token revocation not immediate (60-second re-verification window)
- [ ] Hardcoded/predictable secret key

### 1.2 Login Security
- [ ] Username enumeration via error messages
- [ ] Brute force protection (no rate limiting detected)
- [ ] Credential stuffing protection
- [ ] Password-less user authentication
- [ ] SQL/NoSQL injection in credentials

### 1.3 Session Management
- [ ] Session fixation
- [ ] Logout token invalidation
- [ ] Concurrent session limits
- [ ] Session timeout handling

---

## 2. Authorization Vulnerabilities

### 2.1 ACL Bypass
- [ ] Path traversal in delta paths
- [ ] Context manipulation (vessels.self vs other vessels)
- [ ] Regex pattern matching bypass
- [ ] Wildcard abuse in subscriptions

### 2.2 Permission Escalation
- [ ] readonly -> readwrite escalation
- [ ] readwrite -> admin escalation
- [ ] Permission field injection in requests
- [ ] Device permission manipulation

### 2.3 Admin Endpoint Protection
- [ ] All /skServer/* endpoints require admin
- [ ] Backup/restore endpoints protected
- [ ] Plugin management endpoints protected
- [ ] Settings endpoints protected

---

## 3. Injection Vulnerabilities

### 3.1 Code Injection
- [ ] Prototype pollution via JSON bodies
- [ ] Command injection via plugin system
- [ ] Dynamic require() exploitation
- [ ] eval() usage (if any)

### 3.2 Path Traversal
- [ ] REST API path traversal
- [ ] Static file path traversal
- [ ] Backup file path manipulation
- [ ] Plugin path manipulation

### 3.3 XSS/HTML Injection
- [ ] Admin UI reflected XSS
- [ ] Stored XSS in vessel names/descriptions
- [ ] WebSocket message XSS
- [ ] Error message XSS

---

## 4. WebSocket Vulnerabilities

### 4.1 Protocol Security
- [ ] Unauthenticated connection handling
- [ ] Token verification interval exploitation (60 seconds)
- [ ] Origin header validation
- [ ] Malformed message handling

### 4.2 DoS Vectors
- [ ] Large payload handling
- [ ] Message flooding
- [ ] Subscription abuse
- [ ] Memory exhaustion via WebSocket

### 4.3 Data Integrity
- [ ] Delta injection
- [ ] Source spoofing
- [ ] Timestamp manipulation
- [ ] Context switching attacks

---

## 5. API Vulnerabilities

### 5.1 Input Validation
- [ ] Large payload handling (body-parser limit)
- [ ] Nested JSON depth limits
- [ ] Array size limits
- [ ] Special character handling

### 5.2 File Upload
- [ ] Upload size limits (FILEUPLOADSIZELIMIT)
- [ ] File type validation
- [ ] Filename sanitization
- [ ] Path traversal in uploads

### 5.3 Rate Limiting
- [ ] Login endpoint rate limiting
- [ ] API endpoint rate limiting
- [ ] Error response rate limiting
- [ ] WebSocket connection rate limiting

---

## 6. Configuration Vulnerabilities

### 6.1 Secrets Management
- [ ] Secret key in environment variable
- [ ] Secret key generation strength
- [ ] Hardcoded secrets in codebase
- [ ] Secrets in error messages

### 6.2 Security Headers
- [ ] Missing Content-Security-Policy
- [ ] Missing X-Frame-Options
- [ ] Missing X-Content-Type-Options
- [ ] Missing Strict-Transport-Security (HTTPS)
- [ ] Server version disclosure

### 6.3 CORS Configuration
- [ ] Wildcard origin with credentials
- [ ] Origin reflection
- [ ] Null origin handling
- [ ] Credential handling

---

## 7. Dependency Vulnerabilities

### 7.1 Known CVEs
- [ ] jsonwebtoken < 9.0.0 vulnerabilities
- [ ] lodash prototype pollution
- [ ] moment.js ReDoS
- [ ] express vulnerabilities
- [ ] ws WebSocket vulnerabilities

### 7.2 Supply Chain
- [ ] Dependency integrity (package-lock.json)
- [ ] Optional dependency handling
- [ ] Plugin dependency security

---

## 8. Plugin System Vulnerabilities

### 8.1 Plugin Isolation
- [ ] Plugin sandbox escape
- [ ] Plugin access to server internals
- [ ] Plugin file system access
- [ ] Plugin network access

### 8.2 Plugin Installation
- [ ] Admin-only installation
- [ ] Package validation
- [ ] Code signing verification
- [ ] Malicious plugin detection

---

## 9. Specific Code Locations to Review

### High Priority
- [ ] `src/tokensecurity.js:728-741` - Token comparison timing
- [ ] `src/tokensecurity.js:793-807` - Regex compilation on each ACL check
- [ ] `src/serverroutes.ts:464` - remoteAddress spoofing
- [ ] `src/serverroutes.ts:554` - Password complexity validation

### Medium Priority
- [ ] `src/put.js` - PUT/DELETE handler validation
- [ ] `src/interfaces/ws.js:160` - WebSocket authorization
- [ ] `src/interfaces/plugins.ts` - Plugin loading security
- [ ] `src/deltacache.ts` - Delta storage security

### Information Gathering
- [ ] `src/cors.ts` - CORS implementation
- [ ] `src/security.ts` - Security type definitions
- [ ] `src/config/config.ts` - Configuration handling

---

## Testing Priority

1. **Critical**: Authentication/Authorization bypass
2. **High**: Injection vulnerabilities, WebSocket security
3. **Medium**: DoS vectors, Configuration issues
4. **Low**: Information disclosure, Header security

---

## Reporting

When vulnerabilities are found:
1. Document reproduction steps
2. Assess severity (CVSS score)
3. Create GitHub Security Advisory (private)
4. Propose fix if possible
5. Track in issues (after disclosure period if critical)

---

*Last updated: [DATE]*
*Tested version: 2.19.0-beta.4*
